"use strict";(self.webpackChunkherbaid_server=self.webpackChunkherbaid_server||[]).push([[4121],{6784:(He,S,o)=>{o.r(S),o.d(S,{default:()=>Oe});var e=o(67294),r=o(68547),P=o(87751),W=o(49656),U=o(97132),z=o(17034),F=o(67838),j=o(36989),J=o(49066),Q=o(89722),X=o(46273),Y=o(7681),B=o(12028),M=o(41451),q=o(38939),_=o(49386),ee=o(8060),A=o(79031),d=o(37909),te=o(15234),f=o(72735),x=o(29728),oe=o(63237),le=o(3566),ne=o(185),ae=o(14087),se=o(35961),k=o(96315),re=o(4585),H=o(20022),ie=o(86031),de=o(18172),ce=o(36968),Ee=o.n(ce);const ue={webhooks:[],webhooksToDelete:[],webhookToDelete:null,loadingWebhooks:!0},he=(a,n)=>(0,de.default)(a,l=>{switch(n.type){case"GET_DATA_SUCCEEDED":{l.webhooks=n.data,l.loadingWebhooks=!1;break}case"TOGGLE_LOADING":{l.loadingWebhooks=!a.loadingWebhooks;break}case"SET_WEBHOOK_ENABLED":{Ee()(l,["webhooks",...n.keys],n.value);break}case"SET_WEBHOOK_TO_DELETE":{l.webhookToDelete=n.id;break}case"SET_WEBHOOKS_TO_DELETE":{n.value?l.webhooksToDelete.push(n.id):l.webhooksToDelete=a.webhooksToDelete.filter(i=>i!==n.id);break}case"SET_ALL_WEBHOOKS_TO_DELETE":{a.webhooksToDelete.length===0?l.webhooksToDelete=a.webhooks.map(i=>i.id):l.webhooksToDelete=[];break}case"WEBHOOKS_DELETED":{l.webhooks=a.webhooks.filter(i=>!a.webhooksToDelete.includes(i.id)),l.webhooksToDelete=[];break}case"WEBHOOK_DELETED":{l.webhooks=a.webhooks.filter((i,g)=>g!==n.index),l.webhookToDelete=null;break}default:return l}});var me=o(25108),ge=Object.defineProperty,fe=Object.defineProperties,Te=Object.getOwnPropertyDescriptors,K=Object.getOwnPropertySymbols,ve=Object.prototype.hasOwnProperty,be=Object.prototype.propertyIsEnumerable,I=(a,n,l)=>n in a?ge(a,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[n]=l,v=(a,n)=>{for(var l in n||(n={}))ve.call(n,l)&&I(a,l,n[l]);if(K)for(var l of K(n))be.call(n,l)&&I(a,l,n[l]);return a},ye=(a,n)=>fe(a,Te(n)),y=(a,n,l)=>new Promise((i,g)=>{var T=u=>{try{s(l.next(u))}catch(m){g(m)}},E=u=>{try{s(l.throw(u))}catch(m){g(m)}},s=u=>u.done?i(u.value):Promise.resolve(u.value).then(T,E);s((l=l.apply(a,n)).next())});const De=()=>{const{isLoading:a,allowedActions:{canCreate:n,canRead:l,canUpdate:i,canDelete:g}}=(0,r.useRBAC)(P.Z.settings.webhooks),T=(0,r.useNotification)(),E=(0,e.useRef)(!0),{formatMessage:s}=(0,U.useIntl)(),[u,m]=(0,e.useState)(!1),[{webhooks:D,webhooksToDelete:O,webhookToDelete:w,loadingWebhooks:p},h]=(0,e.useReducer)(he,ue),{notifyStatus:Le}=(0,ae.G)();(0,r.useFocusWhenNavigate)();const{push:Ce}=(0,W.useHistory)(),{pathname:G}=(0,W.useLocation)(),L=D.length,b=O.length,N=t=>D.findIndex(c=>c.id===t);(0,e.useEffect)(()=>(E.current=!0,()=>{E.current=!1}),[]),(0,e.useEffect)(()=>{l&&ke()},[l]);const ke=()=>y(void 0,null,function*(){try{const{data:t}=yield(0,r.request)("/admin/webhooks",{method:"GET"});E.current&&(h({type:"GET_DATA_SUCCEEDED",data:t}),Le("webhooks have been loaded"))}catch(t){me.log(t),E.current&&(t.code!==20&&T({type:"warning",message:{id:"notification.error"}}),h({type:"TOGGLE_LOADING"}))}}),we=()=>{m(t=>!t)},pe=()=>{w?Se():Pe()},Se=()=>y(void 0,null,function*(){try{yield(0,r.request)(`/admin/webhooks/${w}`,{method:"DELETE"}),h({type:"WEBHOOK_DELETED",index:N(w)})}catch(t){t.code!==20&&T({type:"warning",message:{id:"notification.error"}})}m(!1)}),Pe=()=>y(void 0,null,function*(){const t={ids:O};try{yield(0,r.request)("/admin/webhooks/batch-delete",{method:"POST",body:t}),E.current&&h({type:"WEBHOOKS_DELETED"})}catch(c){E.current&&c.code!==20&&T({type:"warning",message:{id:"notification.error"}})}m(!1)}),V=t=>{m(!0),t!=="all"&&h({type:"SET_WEBHOOK_TO_DELETE",id:t})},We=(t,c)=>y(void 0,null,function*(){const Z=N(c),Ae=D[Z],$=[Z,"isEnabled"],R=ye(v({},Ae),{isEnabled:t});delete R.id;try{h({type:"SET_WEBHOOK_ENABLED",keys:$,value:t}),yield(0,r.request)(`/admin/webhooks/${c}`,{method:"PUT",body:R})}catch(xe){E.current&&(h({type:"SET_WEBHOOK_ENABLED",keys:$,value:!t}),xe.code!==20&&T({type:"warning",message:{id:"notification.error"}}))}}),Be=()=>{h({type:"SET_ALL_WEBHOOKS_TO_DELETE"})},Me=(t,c)=>{h({type:"SET_WEBHOOKS_TO_DELETE",value:t,id:c})},C=t=>{Ce(`${G}/${t}`)};return e.createElement(z.A,null,e.createElement(r.SettingsPageTitle,{name:"Webhooks"}),e.createElement(ne.o,{"aria-busy":a||p},e.createElement(F.T,{title:s({id:"Settings.webhooks.title",defaultMessage:"Webhooks"}),subtitle:s({id:"Settings.webhooks.list.description",defaultMessage:"Get POST changes notifications"}),primaryAction:n&&!p&&e.createElement(r.LinkButton,{startIcon:e.createElement(k.default,null),variant:"default",to:`${G}/create`,size:"S"},s({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"}))}),b>0&&g&&e.createElement(j.Z,{startActions:e.createElement(e.Fragment,null,e.createElement(f.Z,{variant:"epsilon",textColor:"neutral600"},s({id:"Settings.webhooks.to.delete",defaultMessage:"{webhooksToDeleteLength, plural, one {# asset} other {# assets}} selected"},{webhooksToDeleteLength:b})),e.createElement(x.z,{onClick:()=>V("all"),startIcon:e.createElement(H.default,null),size:"L",variant:"danger-light"},s({id:"global.delete",defaultMessage:"Delete"})))}),e.createElement(J.D,null,a||p?e.createElement(se.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(r.LoadingIndicatorPage,null)):e.createElement(e.Fragment,null,L>0?e.createElement(q.i,{colCount:5,rowCount:L+1,footer:e.createElement(_.c,{onClick:()=>n?C("create"):{},icon:e.createElement(k.default,null)},s({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"}))},e.createElement(ee.h,null,e.createElement(A.Tr,null,e.createElement(d.Th,null,e.createElement(M.C,{"aria-label":s({id:"global.select-all-entries",defaultMessage:"Select all entries"}),indeterminate:b>0&&b<L,value:b===L,onValueChange:Be})),e.createElement(d.Th,{width:"20%"},e.createElement(f.Z,{variant:"sigma",textColor:"neutral600"},s({id:"global.name",defaultMessage:"Name"}))),e.createElement(d.Th,{width:"60%"},e.createElement(f.Z,{variant:"sigma",textColor:"neutral600"},s({id:"Settings.webhooks.form.url",defaultMessage:"URL"}))),e.createElement(d.Th,{width:"20%"},e.createElement(f.Z,{variant:"sigma",textColor:"neutral600"},s({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"}))),e.createElement(d.Th,null,e.createElement(oe.T,null,s({id:"Settings.webhooks.list.th.actions",defaultMessage:"Actions"}))))),e.createElement(te.p,null,D.map(t=>e.createElement(A.Tr,v({key:t.id},(0,r.onRowClick)({fn:()=>C(t.id),condition:i})),e.createElement(d.Td,v({},r.stopPropagation),e.createElement(M.C,{"aria-label":`${s({id:"global.select",defaultMessage:"Select"})} ${t.name}`,value:O==null?void 0:O.includes(t.id),onValueChange:c=>Me(c,t.id),id:"select",name:"select"})),e.createElement(d.Td,null,e.createElement(f.Z,{fontWeight:"semiBold",textColor:"neutral800"},t.name)),e.createElement(d.Td,null,e.createElement(f.Z,{textColor:"neutral800"},t.url)),e.createElement(d.Td,null,e.createElement(X.k,v({},r.stopPropagation),e.createElement(le.r,{onLabel:s({id:"global.enabled",defaultMessage:"Enabled"}),offLabel:s({id:"global.disabled",defaultMessage:"Disabled"}),label:`${t.name} ${s({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"})}`,selected:t.isEnabled,onChange:()=>We(!t.isEnabled,t.id),visibleLabels:!0}))),e.createElement(d.Td,null,e.createElement(Y.K,v({horizontal:!0,spacing:1},r.stopPropagation),i&&e.createElement(B.h,{onClick:()=>{C(t.id)},label:s({id:"Settings.webhooks.events.update",defaultMessage:"Update"}),icon:e.createElement(re.Z,null),noBorder:!0}),g&&e.createElement(B.h,{onClick:()=>V(t.id),label:s({id:"global.delete",defaultMessage:"Delete"}),icon:e.createElement(H.default,null),noBorder:!0,id:`delete-${t.id}`}))))))):e.createElement(Q.x,{icon:e.createElement(ie.default,{width:"160px"}),content:s({id:"Settings.webhooks.list.empty.description",defaultMessage:"No webhooks found"}),action:e.createElement(x.z,{variant:"secondary",startIcon:e.createElement(k.default,null),onClick:()=>n?C("create"):{}},s({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"}))})))),e.createElement(r.ConfirmDialog,{isOpen:u,onToggleDialog:we,onConfirm:pe}))},Oe=()=>e.createElement(r.CheckPagePermissions,{permissions:P.Z.settings.webhooks.main},e.createElement(De,null))}}]);
