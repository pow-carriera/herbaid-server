"use strict";(self.webpackChunkherbaid_server=self.webpackChunkherbaid_server||[]).push([[9460],{98352:(Z,P,e)=>{e.r(P),e.d(P,{default:()=>ie});var t=e(67294),u=e(68960),C=e(97132),T=e(80831),r=e(68547),x=e(14087),S=e(185),l=e(67838),c=e(49066),m=e(29728),M=e(35961),h=e(7681),B=e(91216),y=e(82562),g=e(72735),p=e(11276),A=e(74571),Q=e(85018),N=e(81912),n=e(89031);const X=[{intlLabel:{id:(0,n.OB)("EditForm.inputToggle.label.email"),defaultMessage:"One account per email address"},description:{id:(0,n.OB)("EditForm.inputToggle.description.email"),defaultMessage:"Disallow the user to create multiple accounts using the same email address with different authentication providers."},name:"unique_email",type:"bool",size:{col:12,xs:12}},{intlLabel:{id:(0,n.OB)("EditForm.inputToggle.label.sign-up"),defaultMessage:"Enable sign-ups"},description:{id:(0,n.OB)("EditForm.inputToggle.description.sign-up"),defaultMessage:"When disabled (OFF), the registration process is forbidden. No one can subscribe anymore no matter the used provider."},name:"allow_register",type:"bool",size:{col:12,xs:12}},{intlLabel:{id:(0,n.OB)("EditForm.inputToggle.label.email-reset-password"),defaultMessage:"Reset password page"},description:{id:(0,n.OB)("EditForm.inputToggle.description.email-reset-password"),defaultMessage:"URL of your application's reset password page."},placeholder:{id:(0,n.OB)("EditForm.inputToggle.placeholder.email-reset-password"),defaultMessage:"ex: https://youtfrontend.com/reset-password"},name:"email_reset_password",type:"text",size:{col:6,xs:12}},{intlLabel:{id:(0,n.OB)("EditForm.inputToggle.label.email-confirmation"),defaultMessage:"Enable email confirmation"},description:{id:(0,n.OB)("EditForm.inputToggle.description.email-confirmation"),defaultMessage:"When enabled (ON), new registered users receive a confirmation email."},name:"email_confirmation",type:"bool",size:{col:12,xs:12}},{intlLabel:{id:(0,n.OB)("EditForm.inputToggle.label.email-confirmation-redirection"),defaultMessage:"Redirection url"},description:{id:(0,n.OB)("EditForm.inputToggle.description.email-confirmation-redirection"),defaultMessage:"After you confirmed your email, choose where you will be redirected."},placeholder:{id:(0,n.OB)("EditForm.inputToggle.placeholder.email-confirmation-redirection"),defaultMessage:"ex: https://youtfrontend.com/email-confirmation"},name:"email_confirmation_redirection",type:"text",size:{col:6,xs:12}}];var L=e(53209);const U=new RegExp("(^$)|((.+:\\/\\/.*)(d*)\\/?(.*))"),V=L.Ry().shape({email_confirmation_redirection:L.nK().when("email_confirmation",{is:!0,then:L.Z_().matches(U).required(),otherwise:L.Z_().nullable()}),email_reset_password:L.Z_(r.translatedErrors.string).matches(U,r.translatedErrors.regex).nullable()});var Y=(a,i,s)=>new Promise((b,E)=>{var F=o=>{try{v(s.next(o))}catch(f){E(f)}},R=o=>{try{v(s.throw(o))}catch(f){E(f)}},v=o=>o.done?b(o.value):Promise.resolve(o.value).then(F,R);v((s=s.apply(a,i)).next())});const J=()=>Y(void 0,null,function*(){const{data:a}=yield n.be.get((0,n.Gc)("advanced"));return a}),k=a=>n.be.put((0,n.Gc)("advanced"),a);var q=Object.defineProperty,_=Object.defineProperties,ee=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertySymbols,te=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable,j=(a,i,s)=>i in a?q(a,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[i]=s,D=(a,i)=>{for(var s in i||(i={}))te.call(i,s)&&j(a,s,i[s]);if(z)for(var s of z(i))ae.call(i,s)&&j(a,s,i[s]);return a},G=(a,i)=>_(a,ee(i)),W=(a,i,s)=>new Promise((b,E)=>{var F=o=>{try{v(s.next(o))}catch(f){E(f)}},R=o=>{try{v(s.throw(o))}catch(f){E(f)}},v=o=>o.done?b(o.value):Promise.resolve(o.value).then(F,R);v((s=s.apply(a,i)).next())});const ne=()=>t.createElement(r.CheckPagePermissions,{permissions:N.Z.readAdvancedSettings},t.createElement(se,null)),se=()=>{const{formatMessage:a}=(0,C.useIntl)(),i=(0,r.useNotification)(),{lockApp:s,unlockApp:b}=(0,r.useOverlayBlocker)(),{notifyStatus:E}=(0,x.G)(),F=(0,u.useQueryClient)();(0,r.useFocusWhenNavigate)();const R=(0,t.useMemo)(()=>({update:N.Z.updateAdvancedSettings}),[]),{isLoading:v,allowedActions:{canUpdate:o}}=(0,r.useRBAC)(R),{status:f,data:K}=(0,u.useQuery)("advanced",()=>J(),{onSuccess(){E(a({id:(0,n.OB)("Form.advancedSettings.data.loaded"),defaultMessage:"Advanced settings data has been loaded"}))},onError(){i({type:"warning",message:{id:(0,n.OB)("notification.error"),defaultMessage:"An error occured"}})}}),re=v||f!=="success",H=(0,u.useMutation)(O=>k(O),{onSuccess(){return W(this,null,function*(){yield F.invalidateQueries("advanced"),i({type:"success",message:{id:(0,n.OB)("notification.success.saved"),defaultMessage:"Saved"}}),b()})},onError(){i({type:"warning",message:{id:(0,n.OB)("notification.error"),defaultMessage:"An error occured"}}),b()},refetchActive:!0}),{isLoading:oe}=H,le=O=>W(void 0,null,function*(){s();const w=O.email_confirmation?O.email_confirmation_redirection:"";yield H.mutateAsync(G(D({},O),{email_confirmation_redirection:w}))});return re?t.createElement(S.o,{"aria-busy":"true"},t.createElement(r.SettingsPageTitle,{name:a({id:(0,n.OB)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})}),t.createElement(l.T,{title:a({id:(0,n.OB)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})}),t.createElement(c.D,null,t.createElement(r.LoadingIndicatorPage,null))):t.createElement(S.o,{"aria-busy":oe},t.createElement(r.SettingsPageTitle,{name:a({id:(0,n.OB)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"})}),t.createElement(T.Formik,{onSubmit:le,initialValues:K.settings,validateOnChange:!1,validationSchema:V,enableReinitialize:!0},({errors:O,values:w,handleChange:$,isSubmitting:de})=>t.createElement(r.Form,null,t.createElement(l.T,{title:a({id:(0,n.OB)("HeaderNav.link.advancedSettings"),defaultMessage:"Advanced Settings"}),primaryAction:t.createElement(m.z,{loading:de,type:"submit",disabled:!o,startIcon:t.createElement(Q.Z,null),size:"S"},a({id:"global.save",defaultMessage:"Save"}))}),t.createElement(c.D,null,t.createElement(M.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(h.K,{spacing:4},t.createElement(g.Z,{variant:"delta",as:"h2"},a({id:"global.settings",defaultMessage:"Settings"})),t.createElement(p.r,{gap:6},t.createElement(A.P,{col:6,s:12},t.createElement(B.P,{label:a({id:(0,n.OB)("EditForm.inputSelect.label.role"),defaultMessage:"Default role for authenticated users"}),value:w.default_role,hint:a({id:(0,n.OB)("EditForm.inputSelect.description.role"),defaultMessage:"It will attach the new authenticated user to the selected role."}),onChange:d=>$({target:{name:"default_role",value:d}})},K.roles.map(d=>t.createElement(y.W,{key:d.type,value:d.type},d.name)))),X.map(d=>{let I=w[d.name];return I||(I=d.type==="bool"?!1:""),t.createElement(A.P,D({key:d.name},d.size),t.createElement(r.GenericInput,G(D({},d),{value:I,error:O[d.name],disabled:d.name==="email_confirmation_redirection"&&w.email_confirmation===!1,onChange:$})))}))))))))},ie=ne},46979:(Z,P,e)=>{e.d(P,{Z:()=>S});var t=e(78648),u=e(68547),C=e.n(u),T=(l,c,m)=>new Promise((M,h)=>{var B=p=>{try{g(m.next(p))}catch(A){h(A)}},y=p=>{try{g(m.throw(p))}catch(A){h(A)}},g=p=>p.done?M(p.value):Promise.resolve(p.value).then(B,y);g((m=m.apply(l,c)).next())});const r=t.Z.create({baseURL:""});r.interceptors.request.use(l=>T(void 0,null,function*(){return l.headers={Authorization:`Bearer ${u.auth.getToken()}`,Accept:"application/json","Content-Type":"application/json"},l}),l=>{Promise.reject(l)}),r.interceptors.response.use(l=>l,l=>{var c;throw((c=l.response)==null?void 0:c.status)===401&&(u.auth.clearAppStorage(),window.location.reload()),l});const S=(0,u.wrapAxiosInstance)(r)},89031:(Z,P,e)=>{e.d(P,{be:()=>t.Z,YX:()=>T,Gc:()=>S,OB:()=>l.Z});var t=e(46979),u=e(96486);const T=c=>Object.keys(c).reduce((m,M)=>{const h=c[M].controllers,B=Object.keys(h).reduce((y,g)=>((0,u.isEmpty)(h[g])||(y[g]=h[g]),y),{});return(0,u.isEmpty)(B)||(m[M]={controllers:B}),m},{});var r=e(31498);const S=c=>`/${r.Z}/${c}`;var l=e(84757)}}]);
