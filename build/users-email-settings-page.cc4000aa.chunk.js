"use strict";(self.webpackChunkherbaid_server=self.webpackChunkherbaid_server||[]).push([[8418],{95972:(W,I,t)=>{t.r(I),t.d(I,{default:()=>De});var e=t(67294),d=t(68960),D=t(97132),s=t(68547),O=t(14087),L=t(185),B=t(67838),c=t(49066),i=t(81912),a=t(89031),p=(n,r,l)=>new Promise((g,v)=>{var P=f=>{try{C(l.next(f))}catch(M){v(M)}},T=f=>{try{C(l.throw(f))}catch(M){v(M)}},C=f=>f.done?g(f.value):Promise.resolve(f.value).then(P,T);C((l=l.apply(n,r)).next())});const b=()=>p(void 0,null,function*(){const{data:n}=yield a.be.get((0,a.Gc)("email-templates"));return n}),A=n=>a.be.put((0,a.Gc)("email-templates"),n);var U=t(45697),m=t.n(U),R=t(38939),j=t(8060),x=t(79031),h=t(37909),o=t(15234),u=t(63237),E=t(72735),y=t(12028),K=t(52624),J=t(4585),ne=t(30815),re=t(85018),se=Object.defineProperty,X=Object.getOwnPropertySymbols,oe=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable,Y=(n,r,l)=>r in n?se(n,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[r]=l,N=(n,r)=>{for(var l in r||(r={}))oe.call(r,l)&&Y(n,l,r[l]);if(X)for(var l of X(r))ie.call(r,l)&&Y(n,l,r[l]);return n};const k=({canUpdate:n,onEditClick:r})=>{const{formatMessage:l}=(0,D.useIntl)();return e.createElement(R.i,{colCount:3,rowCount:3},e.createElement(j.h,null,e.createElement(x.Tr,null,e.createElement(h.Th,{width:"1%"},e.createElement(u.T,null,l({id:(0,a.OB)("Email.template.table.icon.label"),defaultMessage:"icon"}))),e.createElement(h.Th,null,e.createElement(E.Z,{variant:"sigma",textColor:"neutral600"},l({id:(0,a.OB)("Email.template.table.name.label"),defaultMessage:"name"}))),e.createElement(h.Th,{width:"1%"},e.createElement(u.T,null,l({id:(0,a.OB)("Email.template.table.action.label"),defaultMessage:"action"}))))),e.createElement(o.p,null,e.createElement(x.Tr,N({},(0,s.onRowClick)({fn:()=>r("reset_password")})),e.createElement(h.Td,null,e.createElement(K.J,null,e.createElement(ne.Z,{"aria-label":l({id:"global.reset-password",defaultMessage:"Reset password"})}))),e.createElement(h.Td,null,e.createElement(E.Z,null,l({id:"global.reset-password",defaultMessage:"Reset password"}))),e.createElement(h.Td,N({},s.stopPropagation),e.createElement(y.h,{onClick:()=>r("reset_password"),label:l({id:(0,a.OB)("Email.template.form.edit.label"),defaultMessage:"Edit a template"}),noBorder:!0,icon:n&&e.createElement(J.Z,null)}))),e.createElement(x.Tr,N({},(0,s.onRowClick)({fn:()=>r("email_confirmation")})),e.createElement(h.Td,null,e.createElement(K.J,null,e.createElement(re.Z,{"aria-label":l({id:(0,a.OB)("Email.template.email_confirmation"),defaultMessage:"Email address confirmation"})}))),e.createElement(h.Td,null,e.createElement(E.Z,null,l({id:(0,a.OB)("Email.template.email_confirmation"),defaultMessage:"Email address confirmation"}))),e.createElement(h.Td,N({},s.stopPropagation),e.createElement(y.h,{onClick:()=>r("email_confirmation"),label:l({id:(0,a.OB)("Email.template.form.edit.label"),defaultMessage:"Edit a template"}),noBorder:!0,icon:n&&e.createElement(J.Z,null)})))))};k.propTypes={canUpdate:m().bool.isRequired,onEditClick:m().func.isRequired};const me=k;var de=t(80831),ce=t(42866),pe=t(24969),ue=t(59946),Ee=t(36856),ve=t(11276),F=t(74571),q=t(29728),z=t(2407),fe=t(64256),S=t(53209);const ge=S.Ry().shape({options:S.Ry().shape({from:S.Ry().shape({name:S.Z_().required(s.translatedErrors.required),email:S.Z_().email(s.translatedErrors.email).required(s.translatedErrors.required)}).required(),response_email:S.Z_().email(s.translatedErrors.email),object:S.Z_().required(s.translatedErrors.required),message:S.Z_().required(s.translatedErrors.required)}).required(s.translatedErrors.required)}),_=({template:n,onToggle:r,onSubmit:l})=>{const{formatMessage:g}=(0,D.useIntl)();return e.createElement(ce.P,{onClose:r,labelledBy:`${g({id:(0,a.OB)("PopUpForm.header.edit.email-templates"),defaultMessage:"Edit email template"})}, ${g({id:(0,a.OB)(n.display),defaultMessage:n.display})}`},e.createElement(pe.x,null,e.createElement(z.O,{label:`${g({id:(0,a.OB)("PopUpForm.header.edit.email-templates"),defaultMessage:"Edit email template"})}, ${g({id:(0,a.OB)(n.display),defaultMessage:n.display})}`},e.createElement(z.$,null,g({id:(0,a.OB)("PopUpForm.header.edit.email-templates"),defaultMessage:"Edit email template"})),e.createElement(z.$,null,g({id:(0,a.OB)(n.display),defaultMessage:n.display})))),e.createElement(de.Formik,{onSubmit:l,initialValues:n,validateOnChange:!1,validationSchema:ge,enableReinitialize:!0},({errors:v,values:P,handleChange:T,isSubmitting:C})=>{var f,M,$,G,H,w,V;return e.createElement(s.Form,null,e.createElement(ue.f,null,e.createElement(ve.r,{gap:5},e.createElement(F.P,{col:6,s:12},e.createElement(s.GenericInput,{intlLabel:{id:(0,a.OB)("PopUpForm.Email.options.from.name.label"),defaultMessage:"Shipper name"},name:"options.from.name",onChange:T,value:P.options.from.name,error:(M=(f=v==null?void 0:v.options)==null?void 0:f.from)==null?void 0:M.name,type:"text"})),e.createElement(F.P,{col:6,s:12},e.createElement(s.GenericInput,{intlLabel:{id:(0,a.OB)("PopUpForm.Email.options.from.email.label"),defaultMessage:"Shipper email"},name:"options.from.email",onChange:T,value:P.options.from.email,error:(G=($=v==null?void 0:v.options)==null?void 0:$.from)==null?void 0:G.email,type:"text"})),e.createElement(F.P,{col:6,s:12},e.createElement(s.GenericInput,{intlLabel:{id:(0,a.OB)("PopUpForm.Email.options.response_email.label"),defaultMessage:"Response email"},name:"options.response_email",onChange:T,value:P.options.response_email,error:(H=v==null?void 0:v.options)==null?void 0:H.response_email,type:"text"})),e.createElement(F.P,{col:6,s:12},e.createElement(s.GenericInput,{intlLabel:{id:(0,a.OB)("PopUpForm.Email.options.object.label"),defaultMessage:"Subject"},name:"options.object",onChange:T,value:P.options.object,error:(w=v==null?void 0:v.options)==null?void 0:w.object,type:"text"})),e.createElement(F.P,{col:12,s:12},e.createElement(fe.g,{label:g({id:(0,a.OB)("PopUpForm.Email.options.message.label"),defaultMessage:"Message"}),name:"options.message",onChange:T,value:P.options.message,error:((V=v==null?void 0:v.options)==null?void 0:V.message)&&g({id:v.options.message,defaultMessage:v.options.message})})))),e.createElement(Ee.m,{startActions:e.createElement(q.z,{onClick:r,variant:"tertiary"},"Cancel"),endActions:e.createElement(q.z,{loading:C,type:"submit"},"Finish")}))}))};_.propTypes={template:m().shape({display:m().string,icon:m().string,options:m().shape({from:m().shape({name:m().string,email:m().string}),message:m().string,object:m().string,response_email:m().string})}).isRequired,onSubmit:m().func.isRequired,onToggle:m().func.isRequired};const ye=_;var he=Object.defineProperty,Oe=Object.defineProperties,Pe=Object.getOwnPropertyDescriptors,ee=Object.getOwnPropertySymbols,Te=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable,te=(n,r,l)=>r in n?he(n,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[r]=l,Be=(n,r)=>{for(var l in r||(r={}))Te.call(r,l)&&te(n,l,r[l]);if(ee)for(var l of ee(r))Me.call(r,l)&&te(n,l,r[l]);return n},be=(n,r)=>Oe(n,Pe(r)),Re=(n,r,l)=>new Promise((g,v)=>{var P=f=>{try{C(l.next(f))}catch(M){v(M)}},T=f=>{try{C(l.throw(f))}catch(M){v(M)}},C=f=>f.done?g(f.value):Promise.resolve(f.value).then(P,T);C((l=l.apply(n,r)).next())});const Ce=()=>e.createElement(s.CheckPagePermissions,{permissions:i.Z.readEmailTemplates},e.createElement(Ie,null)),Ie=()=>{const{formatMessage:n}=(0,D.useIntl)(),{trackUsage:r}=(0,s.useTracking)(),{notifyStatus:l}=(0,O.G)(),g=(0,s.useNotification)(),{lockApp:v,unlockApp:P}=(0,s.useOverlayBlocker)(),T=(0,e.useRef)(r),C=(0,d.useQueryClient)();(0,s.useFocusWhenNavigate)();const[f,M]=(0,e.useState)(!1),[$,G]=(0,e.useState)(null),H=(0,e.useMemo)(()=>({update:i.Z.updateEmailTemplates}),[]),{isLoading:w,allowedActions:{canUpdate:V}}=(0,s.useRBAC)(H),{status:Le,data:ae}=(0,d.useQuery)("email-templates",()=>b(),{onSuccess(){l(n({id:(0,a.OB)("Email.template.data.loaded"),defaultMessage:"Email templates has been loaded"}))},onError(){g({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),je=w||Le!=="success",Q=()=>{M(Z=>!Z)},Ae=Z=>{G(Z),Q()},le=(0,d.useMutation)(Z=>A({"email-templates":Z}),{onSuccess(){return Re(this,null,function*(){yield C.invalidateQueries("email-templates"),g({type:"success",message:{id:"notification.success.saved",defaultMessage:"Saved"}}),T.current("didEditEmailTemplates"),P(),Q()})},onError(){g({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),P()},refetchActive:!0}),{isLoading:Ue}=le,Se=Z=>{v(),T.current("willEditEmailTemplates");const Ze=be(Be({},ae),{[$]:Z});le.mutate(Ze)};return je?e.createElement(L.o,{"aria-busy":"true"},e.createElement(s.SettingsPageTitle,{name:n({id:(0,a.OB)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),e.createElement(B.T,{title:n({id:(0,a.OB)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),e.createElement(c.D,null,e.createElement(s.LoadingIndicatorPage,null))):e.createElement(L.o,{"aria-busy":Ue},e.createElement(s.SettingsPageTitle,{name:n({id:(0,a.OB)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),e.createElement(B.T,{title:n({id:(0,a.OB)("HeaderNav.link.emailTemplates"),defaultMessage:"Email templates"})}),e.createElement(c.D,null,e.createElement(me,{onEditClick:Ae,canUpdate:V}),f&&e.createElement(ye,{template:ae[$],onToggle:Q,onSubmit:Se})))},De=Ce},46979:(W,I,t)=>{t.d(I,{Z:()=>B});var e=t(78648),d=t(68547),D=t.n(d),s=(c,i,a)=>new Promise((p,b)=>{var A=R=>{try{m(a.next(R))}catch(j){b(j)}},U=R=>{try{m(a.throw(R))}catch(j){b(j)}},m=R=>R.done?p(R.value):Promise.resolve(R.value).then(A,U);m((a=a.apply(c,i)).next())});const O=e.Z.create({baseURL:""});O.interceptors.request.use(c=>s(void 0,null,function*(){return c.headers={Authorization:`Bearer ${d.auth.getToken()}`,Accept:"application/json","Content-Type":"application/json"},c}),c=>{Promise.reject(c)}),O.interceptors.response.use(c=>c,c=>{var i;throw((i=c.response)==null?void 0:i.status)===401&&(d.auth.clearAppStorage(),window.location.reload()),c});const B=(0,d.wrapAxiosInstance)(O)},89031:(W,I,t)=>{t.d(I,{be:()=>e.Z,YX:()=>s,Gc:()=>B,OB:()=>c.Z});var e=t(46979),d=t(96486);const s=i=>Object.keys(i).reduce((a,p)=>{const b=i[p].controllers,A=Object.keys(b).reduce((U,m)=>((0,d.isEmpty)(b[m])||(U[m]=b[m]),U),{});return(0,d.isEmpty)(A)||(a[p]={controllers:A}),a},{});var O=t(31498);const B=i=>`/${O.Z}/${i}`;var c=t(84757)},2407:(W,I,t)=>{t.d(I,{$:()=>j,O:()=>h});var e=t(67294),d=t(45697),D=t(71893),s=t(16405),O=t(72735),L=t(35961),B=t(46273),c=t(63237),i=Object.defineProperty,a=Object.getOwnPropertySymbols,p=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable,A=(o,u,E)=>u in o?i(o,u,{enumerable:!0,configurable:!0,writable:!0,value:E}):o[u]=E,U=(o,u)=>{for(var E in u||(u={}))p.call(u,E)&&A(o,E,u[E]);if(a)for(var E of a(u))b.call(u,E)&&A(o,E,u[E]);return o},m=(o,u)=>{var E={};for(var y in o)p.call(o,y)&&u.indexOf(y)<0&&(E[y]=o[y]);if(o!=null&&a)for(var y of a(o))u.indexOf(y)<0&&b.call(o,y)&&(E[y]=o[y]);return E};const R=(0,D.default)(B.k)`
  svg {
    height: ${10/16}rem;
    width: ${10/16}rem;
    path {
      fill: ${({theme:o})=>o.colors.neutral500};
    }
  }
  :last-of-type ${L.x} {
    display: none;
  }
  :last-of-type ${O.Z} {
    color: ${({theme:o})=>o.colors.neutral800};
    font-weight: ${({theme:o})=>o.fontWeights.bold};
  }
`,j=({children:o})=>e.createElement(R,{inline:!0,as:"li"},e.createElement(O.Z,{variant:"pi",textColor:"neutral600"},o),e.createElement(L.x,{"aria-hidden":!0,paddingLeft:3,paddingRight:3},e.createElement(s.default,null)));j.displayName="Crumb",j.propTypes={children:d.node.isRequired};const x=d.shape({type:d.oneOf([j])}),h=o=>{var u=o,{children:E,label:y}=u,K=m(u,["children","label"]);return e.createElement(B.k,U({},K),e.createElement(c.T,null,y),e.createElement("ol",{"aria-hidden":!0},E))};h.displayName="Breadcrumbs",h.propTypes={children:d.oneOfType([d.arrayOf(x),x]).isRequired,label:d.string.isRequired}},30815:(W,I,t)=>{t.d(I,{Z:()=>c});var e=t(67294),d=Object.defineProperty,D=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,L=(i,a,p)=>a in i?d(i,a,{enumerable:!0,configurable:!0,writable:!0,value:p}):i[a]=p,B=(i,a)=>{for(var p in a||(a={}))s.call(a,p)&&L(i,p,a[p]);if(D)for(var p of D(a))O.call(a,p)&&L(i,p,a[p]);return i};function c(i){return e.createElement("svg",B({width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},i),e.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15.681 2.804A9.64 9.64 0 0011.818 2C6.398 2 2 6.48 2 12c0 5.521 4.397 10 9.818 10 2.03 0 4.011-.641 5.67-1.835a9.987 9.987 0 003.589-4.831 1.117 1.117 0 00-.664-1.418 1.086 1.086 0 00-1.393.676 7.769 7.769 0 01-2.792 3.758 7.546 7.546 0 01-4.41 1.428V4.222h.002a7.492 7.492 0 013.003.625 7.61 7.61 0 012.5 1.762l.464.551-2.986 3.042a.186.186 0 00.129.316H22V3.317a.188.188 0 00-.112-.172.179.179 0 00-.199.04l-2.355 2.4-.394-.468-.02-.02a9.791 9.791 0 00-3.239-2.293zm-3.863 1.418V2v2.222zm0 0v15.556c-4.216 0-7.636-3.484-7.636-7.778s3.42-7.777 7.636-7.778z",fill:"#212134"}))}}}]);
