"use strict";(self.webpackChunkherbaid_server=self.webpackChunkherbaid_server||[]).push([[2282],{8971:(G,A,t)=>{t.r(A),t.d(A,{ProvidersPage:()=>ye,default:()=>rt});var e=t(67294),f=t(97132),d=t(68547),x=t(18721),C=t.n(x),w=t(11700),F=t.n(w),h=t(17034),M=t(67838),y=t(49066),Z=t(185),L=t(14087),U=t(38939),S=t(8060),R=t(79031),g=t(37909),B=t(15234),j=t(72735),z=t(63237),l=t(12028),v=t(4585),m=t(68960),n=t(53209),c=t(89031);const se={id:(0,c.OB)("PopUpForm.Providers.redirectURL.front-end.label"),defaultMessage:"The redirect URL to your front-end app"},ne={id:"http://www.client-app.com",defaultMessage:"http://www.client-app.com"},X={id:(0,c.OB)("PopUpForm.Providers.enabled.description"),defaultMessage:"If disabled, users won't be able to use this provider."},Q={id:(0,c.OB)("PopUpForm.Providers.enabled.label"),defaultMessage:"Enable"},oe={id:(0,c.OB)("PopUpForm.Providers.key.label"),defaultMessage:"Client ID"},le={id:(0,c.OB)("PopUpForm.Providers.redirectURL.label"),defaultMessage:"The redirect URL to add in your {provider} application configurations"},K={id:(0,c.OB)("PopUpForm.Providers.key.placeholder"),defaultMessage:"TEXT"},ie={id:(0,c.OB)("PopUpForm.Providers.secret.label"),defaultMessage:"Client Secret"},Y={email:{form:[[{intlLabel:Q,name:"enabled",type:"bool",description:X,size:6}]],schema:n.Ry().shape({enabled:n.Xg().required(d.translatedErrors.required)})},providers:{form:[[{intlLabel:Q,name:"enabled",type:"bool",description:X,size:6,validations:{required:!0}}],[{intlLabel:oe,name:"key",type:"text",placeholder:K,size:12,validations:{required:!0}}],[{intlLabel:ie,name:"secret",type:"text",placeholder:K,size:12,validations:{required:!0}}],[{intlLabel:se,placeholder:ne,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:le,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:n.Ry().shape({enabled:n.Xg().required(d.translatedErrors.required),key:n.Z_().when("enabled",{is:!0,then:n.Z_().required(d.translatedErrors.required),otherwise:n.Z_()}),secret:n.Z_().when("enabled",{is:!0,then:n.Z_().required(d.translatedErrors.required),otherwise:n.Z_()}),callback:n.Z_().when("enabled",{is:!0,then:n.Z_().required(d.translatedErrors.required),otherwise:n.Z_()})})},providersWithSubdomain:{form:[[{intlLabel:Q,name:"enabled",type:"bool",description:X,size:6,validations:{required:!0}}],[{intlLabel:oe,name:"key",type:"text",placeholder:K,size:12,validations:{required:!0}}],[{intlLabel:ie,name:"secret",type:"text",placeholder:K,size:12,validations:{required:!0}}],[{intlLabel:{id:(0,c.OB)("PopUpForm.Providers.subdomain.label"),defaultMessage:"Host URI (Subdomain)"},name:"subdomain",type:"text",placeholder:{id:(0,c.OB)("PopUpForm.Providers.subdomain.placeholder"),defaultMessage:"my.subdomain.com"},size:12,validations:{required:!0}}],[{intlLabel:se,placeholder:ne,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:le,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:n.Ry().shape({enabled:n.Xg().required(d.translatedErrors.required),key:n.Z_().when("enabled",{is:!0,then:n.Z_().required(d.translatedErrors.required),otherwise:n.Z_()}),secret:n.Z_().when("enabled",{is:!0,then:n.Z_().required(d.translatedErrors.required),otherwise:n.Z_()}),subdomain:n.Z_().when("enabled",{is:!0,then:n.Z_().required(d.translatedErrors.required),otherwise:n.Z_()}),callback:n.Z_().when("enabled",{is:!0,then:n.Z_().required(d.translatedErrors.required),otherwise:n.Z_()})})}};var Oe=(a,r,s)=>new Promise((E,p)=>{var T=u=>{try{b(s.next(u))}catch(i){p(i)}},P=u=>{try{b(s.throw(u))}catch(i){p(i)}},b=u=>u.done?E(u.value):Promise.resolve(u.value).then(T,P);b((s=s.apply(a,r)).next())});const Me=a=>Oe(void 0,null,function*(){try{const{data:r}=yield c.be.get((0,c.Gc)("providers"));return r}catch(r){throw a({type:"warning",message:{id:"notification.error"}}),new Error("error")}}),Te=a=>c.be.put((0,c.Gc)("providers"),a);var Re=t(96486);const Le=a=>(0,Re.sortBy)(Object.keys(a).reduce((r,s)=>{const{icon:E,enabled:p,subdomain:T}=a[s],P=E==="envelope"?["fas","envelope"]:["fab",E];return T!==void 0?r.push({name:s,icon:P,enabled:p,subdomain:T}):r.push({name:s,icon:P,enabled:p}),r},[]),"name");var de=t(81912),ue=t(29728),Ce=t(7681),ce=t(2407),Be=t(11276),De=t(74571),Ie=t(42866),Ze=t(24969),Ue=t(59946),Se=t(36856),Ae=t(45697),o=t.n(Ae),Fe=t(80831),je=t(20707),xe=t(16364),Ne=Object.defineProperty,me=Object.getOwnPropertySymbols,we=Object.prototype.hasOwnProperty,We=Object.prototype.propertyIsEnumerable,pe=(a,r,s)=>r in a?Ne(a,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[r]=s,J=(a,r)=>{for(var s in r||(r={}))we.call(r,s)&&pe(a,s,r[s]);if(me)for(var s of me(r))We.call(r,s)&&pe(a,s,r[s]);return a};const q=({description:a,disabled:r,intlLabel:s,error:E,name:p,onChange:T,placeholder:P,providerToEditName:b,type:u,value:i})=>{const{formatMessage:D}=(0,f.useIntl)(),N=p==="noName"?`${strapi.backendURL}/api/connect/${b}/callback`:i,W=D({id:s.id,defaultMessage:s.defaultMessage},J({provider:b},s.values)),I=a?D({id:a.id,defaultMessage:a.defaultMessage},J({provider:b},a.values)):"";if(u==="bool")return e.createElement(je.s,{"aria-label":p,checked:i,disabled:r,hint:I,label:W,name:p,offLabel:D({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:D({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:$=>{T({target:{name:p,value:$.target.checked}})}});const ee=P?D({id:P.id,defaultMessage:P.defaultMessage},J({},P.values)):"",te=E?D({id:E,defaultMessage:E}):"";return e.createElement(xe.o,{"aria-label":p,disabled:r,error:te,label:W,name:p,onChange:T,placeholder:ee,type:u,value:N})};q.defaultProps={description:null,disabled:!1,error:"",placeholder:null,value:""},q.propTypes={description:o().shape({id:o().string.isRequired,defaultMessage:o().string.isRequired,values:o().object}),disabled:o().bool,error:o().string,intlLabel:o().shape({id:o().string.isRequired,defaultMessage:o().string.isRequired,values:o().object}).isRequired,name:o().string.isRequired,onChange:o().func.isRequired,placeholder:o().shape({id:o().string.isRequired,defaultMessage:o().string.isRequired,values:o().object}),providerToEditName:o().string.isRequired,type:o().string.isRequired,value:o().oneOfType([o().bool,o().string])};const ze=q;var $e=Object.defineProperty,Ke=Object.defineProperties,He=Object.getOwnPropertyDescriptors,ve=Object.getOwnPropertySymbols,Ve=Object.prototype.hasOwnProperty,Ge=Object.prototype.propertyIsEnumerable,fe=(a,r,s)=>r in a?$e(a,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[r]=s,Xe=(a,r)=>{for(var s in r||(r={}))Ve.call(r,s)&&fe(a,s,r[s]);if(ve)for(var s of ve(r))Ge.call(r,s)&&fe(a,s,r[s]);return a},Qe=(a,r)=>Ke(a,He(r));const k=({headerBreadcrumbs:a,initialData:r,isSubmiting:s,layout:E,isOpen:p,onSubmit:T,onToggle:P,providerToEditName:b})=>{const{formatMessage:u}=(0,f.useIntl)();return p?e.createElement(Ie.P,{onClose:P,labelledBy:"title"},e.createElement(Ze.x,null,e.createElement(ce.O,{label:a.join(", ")},a.map(i=>e.createElement(ce.$,{key:i},i)))),e.createElement(Fe.Formik,{onSubmit:i=>T(i),initialValues:r,validationSchema:E.schema,validateOnChange:!1},({errors:i,handleChange:D,values:N})=>e.createElement(d.Form,null,e.createElement(Ue.f,null,e.createElement(Ce.K,{spacing:1},e.createElement(Be.r,{gap:5},E.form.map(W=>W.map(I=>e.createElement(De.P,{key:I.name,col:I.size,xs:12},e.createElement(ze,Qe(Xe({},I),{error:i[I.name],onChange:D,value:N[I.name],providerToEditName:b})))))))),e.createElement(Se.m,{startActions:e.createElement(ue.z,{variant:"tertiary",onClick:P,type:"button"},u({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:e.createElement(ue.z,{type:"submit",loading:s},u({id:"global.save",defaultMessage:"Save"}))})))):null};k.defaultProps={initialData:null,providerToEditName:null},k.propTypes={headerBreadcrumbs:o().arrayOf(o().string).isRequired,initialData:o().object,layout:o().shape({form:o().arrayOf(o().array),schema:o().object}).isRequired,isOpen:o().bool.isRequired,isSubmiting:o().bool.isRequired,onSubmit:o().func.isRequired,onToggle:o().func.isRequired,providerToEditName:o().string};const Ye=k;var Je=Object.defineProperty,qe=Object.defineProperties,ke=Object.getOwnPropertyDescriptors,he=Object.getOwnPropertySymbols,_e=Object.prototype.hasOwnProperty,et=Object.prototype.propertyIsEnumerable,ge=(a,r,s)=>r in a?Je(a,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[r]=s,_=(a,r)=>{for(var s in r||(r={}))_e.call(r,s)&&ge(a,s,r[s]);if(he)for(var s of he(r))et.call(r,s)&&ge(a,s,r[s]);return a},tt=(a,r)=>qe(a,ke(r)),Pe=(a,r,s)=>new Promise((E,p)=>{var T=u=>{try{b(s.next(u))}catch(i){p(i)}},P=u=>{try{b(s.throw(u))}catch(i){p(i)}},b=u=>u.done?E(u.value):Promise.resolve(u.value).then(T,P);b((s=s.apply(a,r)).next())});const ye=()=>{const{formatMessage:a}=(0,f.useIntl)();(0,d.useFocusWhenNavigate)();const{notifyStatus:r}=(0,L.G)(),s=(0,m.useQueryClient)(),{trackUsage:E}=(0,d.useTracking)(),p=(0,e.useRef)(E),[T,P]=(0,e.useState)(!1),[b,u]=(0,e.useState)(!1),[i,D]=(0,e.useState)(null),N=(0,d.useNotification)(),{lockApp:W,unlockApp:I}=(0,d.useOverlayBlocker)(),ee=(0,e.useMemo)(()=>({update:de.Z.updateProviders}),[]),{isLoading:te,allowedActions:{canUpdate:$}}=(0,d.useRBAC)(ee),{isLoading:at,data:H,isFetching:st}=(0,m.useQuery)("get-providers",()=>Me(N),{onSuccess(){r(a({id:(0,c.OB)("Providers.data.loaded"),defaultMessage:"Providers have been loaded"}))},initialData:{}}),nt=at||st,ot=(0,m.useMutation)(Te,{onSuccess(){return Pe(this,null,function*(){yield s.invalidateQueries("get-providers"),N({type:"info",message:{id:(0,c.OB)("notification.success.submit")}}),p.current("didEditAuthenticationProvider"),u(!1),re(),I()})},onError(){N({type:"warning",message:{id:"notification.error"}}),I(),u(!1)},refetchActive:!1}),V=(0,e.useMemo)(()=>Le(H),[H]),lt=V.length,Ee=(0,e.useMemo)(()=>{if(!i)return!1;const O=V.find(ae=>ae.name===i);return C()(O,"subdomain")},[V,i]),it=a({id:(0,c.OB)("HeaderNav.link.providers"),defaultMessage:"Providers"}),dt=(0,e.useMemo)(()=>i==="email"?Y.email:Ee?Y.providersWithSubdomain:Y.providers,[i,Ee]),re=()=>{P(O=>!O)},be=O=>{$&&(D(O.name),re())},ut=O=>Pe(void 0,null,function*(){u(!0),W(),p.current("willEditAuthenticationProvider");const ae=tt(_({},H),{[i]:O});ot.mutate({providers:ae})});return e.createElement(h.A,null,e.createElement(d.SettingsPageTitle,{name:it}),e.createElement(Z.o,null,e.createElement(M.T,{title:a({id:(0,c.OB)("HeaderNav.link.providers"),defaultMessage:"Providers"})}),nt||te?e.createElement(d.LoadingIndicatorPage,null):e.createElement(y.D,null,e.createElement(U.i,{colCount:3,rowCount:lt+1},e.createElement(S.h,null,e.createElement(R.Tr,null,e.createElement(g.Th,null,e.createElement(j.Z,{variant:"sigma",textColor:"neutral600"},a({id:"global.name",defaultMessage:"Name"}))),e.createElement(g.Th,null,e.createElement(j.Z,{variant:"sigma",textColor:"neutral600"},a({id:(0,c.OB)("Providers.status"),defaultMessage:"Status"}))),e.createElement(g.Th,null,e.createElement(j.Z,{variant:"sigma"},e.createElement(z.T,null,a({id:"global.settings",defaultMessage:"Settings"})))))),e.createElement(B.p,null,V.map(O=>e.createElement(R.Tr,_({key:O.name},(0,d.onRowClick)({fn:()=>be(O),condition:$})),e.createElement(g.Td,{width:"45%"},e.createElement(j.Z,{fontWeight:"semiBold",textColor:"neutral800"},O.name)),e.createElement(g.Td,{width:"65%"},e.createElement(j.Z,{textColor:O.enabled?"success600":"danger600","data-testid":`enable-${O.name}`},O.enabled?a({id:"global.enabled",defaultMessage:"Enabled"}):a({id:"global.disabled",defaultMessage:"Disabled"}))),e.createElement(g.Td,_({},d.stopPropagation),$&&e.createElement(l.h,{onClick:()=>be(O),noBorder:!0,icon:e.createElement(v.Z,null),label:"Edit"})))))))),e.createElement(Ye,{initialData:H[i],isOpen:T,isSubmiting:b,layout:dt,headerBreadcrumbs:[a({id:(0,c.OB)("PopUpForm.header.edit.providers"),defaultMessage:"Edit Provider"}),F()(i)],onToggle:re,onSubmit:ut,providerToEditName:i}))},rt=()=>e.createElement(d.CheckPagePermissions,{permissions:de.Z.readProviders},e.createElement(ye,null))},46979:(G,A,t)=>{t.d(A,{Z:()=>F});var e=t(78648),f=t(68547),d=t.n(f),x=(h,M,y)=>new Promise((Z,L)=>{var U=g=>{try{R(y.next(g))}catch(B){L(B)}},S=g=>{try{R(y.throw(g))}catch(B){L(B)}},R=g=>g.done?Z(g.value):Promise.resolve(g.value).then(U,S);R((y=y.apply(h,M)).next())});const C=e.Z.create({baseURL:""});C.interceptors.request.use(h=>x(void 0,null,function*(){return h.headers={Authorization:`Bearer ${f.auth.getToken()}`,Accept:"application/json","Content-Type":"application/json"},h}),h=>{Promise.reject(h)}),C.interceptors.response.use(h=>h,h=>{var M;throw((M=h.response)==null?void 0:M.status)===401&&(f.auth.clearAppStorage(),window.location.reload()),h});const F=(0,f.wrapAxiosInstance)(C)},89031:(G,A,t)=>{t.d(A,{be:()=>e.Z,YX:()=>x,Gc:()=>F,OB:()=>h.Z});var e=t(46979),f=t(96486);const x=M=>Object.keys(M).reduce((y,Z)=>{const L=M[Z].controllers,U=Object.keys(L).reduce((S,R)=>((0,f.isEmpty)(L[R])||(S[R]=L[R]),S),{});return(0,f.isEmpty)(U)||(y[Z]={controllers:U}),y},{});var C=t(31498);const F=M=>`/${C.Z}/${M}`;var h=t(84757)},2407:(G,A,t)=>{t.d(A,{$:()=>B,O:()=>z});var e=t(67294),f=t(45697),d=t(71893),x=t(16405),C=t(72735),w=t(35961),F=t(46273),h=t(63237),M=Object.defineProperty,y=Object.getOwnPropertySymbols,Z=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,U=(l,v,m)=>v in l?M(l,v,{enumerable:!0,configurable:!0,writable:!0,value:m}):l[v]=m,S=(l,v)=>{for(var m in v||(v={}))Z.call(v,m)&&U(l,m,v[m]);if(y)for(var m of y(v))L.call(v,m)&&U(l,m,v[m]);return l},R=(l,v)=>{var m={};for(var n in l)Z.call(l,n)&&v.indexOf(n)<0&&(m[n]=l[n]);if(l!=null&&y)for(var n of y(l))v.indexOf(n)<0&&L.call(l,n)&&(m[n]=l[n]);return m};const g=(0,d.default)(F.k)`
  svg {
    height: ${10/16}rem;
    width: ${10/16}rem;
    path {
      fill: ${({theme:l})=>l.colors.neutral500};
    }
  }
  :last-of-type ${w.x} {
    display: none;
  }
  :last-of-type ${C.Z} {
    color: ${({theme:l})=>l.colors.neutral800};
    font-weight: ${({theme:l})=>l.fontWeights.bold};
  }
`,B=({children:l})=>e.createElement(g,{inline:!0,as:"li"},e.createElement(C.Z,{variant:"pi",textColor:"neutral600"},l),e.createElement(w.x,{"aria-hidden":!0,paddingLeft:3,paddingRight:3},e.createElement(x.default,null)));B.displayName="Crumb",B.propTypes={children:f.node.isRequired};const j=f.shape({type:f.oneOf([B])}),z=l=>{var v=l,{children:m,label:n}=v,c=R(v,["children","label"]);return e.createElement(F.k,S({},c),e.createElement(h.T,null,n),e.createElement("ol",{"aria-hidden":!0},m))};z.displayName="Breadcrumbs",z.propTypes={children:f.oneOfType([f.arrayOf(j),j]).isRequired,label:f.string.isRequired}}}]);
